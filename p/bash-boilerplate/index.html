<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Rock-solid bash script template for easy scripting"><title>Bash Boilerplate</title>
<link rel=canonical href=https://killparty.github.io/p/bash-boilerplate/><link rel=stylesheet href=/scss/style.min.1652e8b85eb308338e4d5f9a5f2a2aad5f7d88be03114a4399a12a461ce25c99.css><meta property='og:title' content="Bash Boilerplate"><meta property='og:description' content="Rock-solid bash script template for easy scripting"><meta property='og:url' content='https://killparty.github.io/p/bash-boilerplate/'><meta property='og:site_name' content='killp@rty:~# kill $PID'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-10-23T17:02:00+00:00'><meta property='article:modified_time' content='2024-10-23T17:02:00+00:00'><meta name=twitter:title content="Bash Boilerplate"><meta name=twitter:description content="Rock-solid bash script template for easy scripting"><link rel="shortcut icon" href=/favicon.ico><style>:root{--article-font-family:"Fira Sans", var(--base-font-family)}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu15261210469476545923.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>killp@rty:~# kill $PID</a></h1><h2 class=site-description>Code-blooded threat response</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/bash-boilerplate/>Bash Boilerplate</a></h2><h3 class=article-subtitle>Rock-solid bash script template for easy scripting</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 23, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>Writing reliable Bash scripts can be tricky, but having a solid starting point helps. Below is a Bash boilerplate that I often use to make scripts safer and easier to manage.</p><p>It includes strict error handling (<code>set -euo pipefail</code>) to catch mistakes early, log rotation to keep log files from getting too big, and a lockfile to prevent multiple script instances from running at the same time. Thereâ€™s also a section for checking dependencies and handling cleanups.</p><h3 id=customization>Customization:</h3><ul><li>Modify the <code>main</code> function to include the actual logic of your script.</li><li>Add or remove dependencies as needed in the <code>check_dependencies</code> function.</li><li>Adjust paths for the <code>LOCKFILE</code> and <code>LOGFILE</code> as per your requirements.</li><li>Remove the root check in case it is not required.</li></ul><p>This template ensures your script adheres to good security and reliability standards, minimizing the risk of common pitfalls in bash scripting.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># Strict mode - makes the script safer and more reliable</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl><span class=nv>IFS</span><span class=o>=</span><span class=s1>$&#39;\n\t&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Variables</span>
</span></span><span class=line><span class=cl><span class=nv>LOCKFILE</span><span class=o>=</span><span class=s2>&#34;/tmp/</span><span class=k>$(</span>basename <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>.lock&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LOGFILE</span><span class=o>=</span><span class=s2>&#34;/var/log/</span><span class=k>$(</span>basename <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PID</span><span class=o>=</span><span class=nv>$$</span>
</span></span><span class=line><span class=cl><span class=nv>SCRIPT_NAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>basename <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>START_TIME</span><span class=o>=</span><span class=k>$(</span>date <span class=s1>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>MAX_LOG_SIZE</span><span class=o>=</span><span class=m>1048576</span>  <span class=c1># Max log size in bytes (1MB = 1048576 bytes)</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_BACKUP_COUNT</span><span class=o>=</span><span class=m>5</span>     <span class=c1># Number of rotated logs to keep</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Logging function</span>
</span></span><span class=line><span class=cl>log<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>level</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>message</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$START_TIME</span><span class=s2> [</span><span class=nv>$level</span><span class=s2>] : </span><span class=nv>$message</span><span class=s2>&#34;</span> <span class=p>|</span> tee -a <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    rotate_log_if_needed
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Log rotation function</span>
</span></span><span class=line><span class=cl>rotate_log_if_needed<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>local</span> log_size
</span></span><span class=line><span class=cl>        <span class=nv>log_size</span><span class=o>=</span><span class=k>$(</span>stat -c%s <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>((</span> log_size &gt; MAX_LOG_SIZE <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$START_TIME</span><span class=s2> [INFO] : Log file exceeded </span><span class=nv>$MAX_LOG_SIZE</span><span class=s2> bytes, rotating logs.&#34;</span> &gt;&gt; <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>((</span> <span class=nv>i</span><span class=o>=</span>LOG_BACKUP_COUNT-1<span class=p>;</span> i&gt;0<span class=p>;</span> i-- <span class=o>))</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>.</span><span class=nv>$i</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>                    mv <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>.</span><span class=nv>$i</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>.</span><span class=k>$((</span>i+1<span class=k>))</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=k>fi</span>
</span></span><span class=line><span class=cl>            <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            mv <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>.1&#34;</span>
</span></span><span class=line><span class=cl>            : &gt; <span class=s2>&#34;</span><span class=nv>$LOGFILE</span><span class=s2>&#34;</span>  <span class=c1># Truncate the log file</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Clean up function</span>
</span></span><span class=line><span class=cl>cleanup<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;</span><span class=nv>$LOCKFILE</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        rm -f <span class=s2>&#34;</span><span class=nv>$LOCKFILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        log <span class=s2>&#34;INFO&#34;</span> <span class=s2>&#34;Lock file removed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Lockfile mechanism to avoid multiple instances</span>
</span></span><span class=line><span class=cl>create_lockfile<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;</span><span class=nv>$LOCKFILE</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        log <span class=s2>&#34;ERROR&#34;</span> <span class=s2>&#34;Lockfile exists: </span><span class=nv>$LOCKFILE</span><span class=s2>. Another instance is running.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$PID</span><span class=s2>&#34;</span> &gt; <span class=s2>&#34;</span><span class=nv>$LOCKFILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;INFO&#34;</span> <span class=s2>&#34;Created lockfile: </span><span class=nv>$LOCKFILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Trap signals to ensure cleanup</span>
</span></span><span class=line><span class=cl><span class=nb>trap</span> <span class=s1>&#39;cleanup; exit&#39;</span> INT TERM EXIT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Root check (if needed)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$EUID</span><span class=s2>&#34;</span> -ne <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>   log <span class=s2>&#34;ERROR&#34;</span> <span class=s2>&#34;This script must be run as root&#34;</span>
</span></span><span class=line><span class=cl>   <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Secure PATH (avoids executing malicious binaries in an altered PATH)</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=s1>&#39;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to check required commands (dependencies)</span>
</span></span><span class=line><span class=cl>check_dependencies<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>dependencies</span><span class=o>=(</span><span class=s2>&#34;command1&#34;</span> <span class=s2>&#34;command2&#34;</span><span class=o>)</span> <span class=c1># Replace with actual commands</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> cmd in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dependencies</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> ! <span class=nb>command</span> -v <span class=s2>&#34;</span><span class=nv>$cmd</span><span class=s2>&#34;</span> <span class=p>&amp;</span>&gt; /dev/null<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            log <span class=s2>&#34;ERROR&#34;</span> <span class=s2>&#34;Dependency &#39;</span><span class=nv>$cmd</span><span class=s2>&#39; is not installed or not in PATH.&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to handle errors</span>
</span></span><span class=line><span class=cl>error_handler<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>exit_code</span><span class=o>=</span><span class=nv>$?</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>line_no</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;ERROR&#34;</span> <span class=s2>&#34;Error on line </span><span class=nv>$line_no</span><span class=s2>: Exit code </span><span class=nv>$exit_code</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=s2>&#34;</span><span class=nv>$exit_code</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=nb>trap</span> <span class=s1>&#39;error_handler $LINENO&#39;</span> ERR
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Main script logic</span>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;INFO&#34;</span> <span class=s2>&#34;Starting script: </span><span class=nv>$SCRIPT_NAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Add your script logic here</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;INFO&#34;</span> <span class=s2>&#34;Script completed successfully&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Run the main logic</span>
</span></span><span class=line><span class=cl>create_lockfile
</span></span><span class=line><span class=cl>check_dependencies
</span></span><span class=line><span class=cl>main
</span></span><span class=line><span class=cl>cleanup
</span></span></code></pre></td></tr></table></div></div><h3 id=explanation-and-best-practices>Explanation and Best Practices:</h3><ol><li><p><strong>Strict Mode</strong>:</p><ul><li><code>set -euo pipefail</code>:<ul><li><code>-e</code>: Exit immediately if a command exits with a non-zero status.</li><li><code>-u</code>: Treat unset variables as an error.</li><li><code>-o pipefail</code>: Ensures that if any part of a pipe fails, the entire pipeline fails.</li></ul></li><li><code>IFS=$'\n\t'</code>: Ensures that word splitting is done only on newlines and tabs, preventing security issues with spaces.</li></ul></li><li><p><strong>Lockfile Mechanism</strong>:</p><ul><li>The script uses a lockfile (<code>/tmp/${SCRIPT_NAME}.lock</code>) to ensure only one instance runs at a time.</li><li>If the script is already running (lockfile exists), it exits to avoid multiple instances.</li></ul></li><li><p><strong>Logging</strong>:</p><ul><li><code>log()</code> function logs messages with a timestamp, log level (<code>INFO</code>, <code>ERROR</code>, etc.), and appends them to a log file (<code>/var/log/${SCRIPT_NAME}.log</code>).</li><li>Log entries are echoed to both the terminal and log file.</li></ul></li><li><p><strong>Signal Trapping and Cleanup</strong>:</p><ul><li><code>trap 'cleanup; exit' INT TERM EXIT</code>: This ensures the lockfile is removed if the script exits unexpectedly (e.g., via <code>Ctrl+C</code> or system signals).</li><li>Cleanup function removes the lockfile, avoiding stale lockfiles.</li></ul></li><li><p><strong>Root Check</strong>:</p><ul><li>If the script requires root privileges, this check prevents it from running as a non-root user.</li></ul></li><li><p><strong>Secure PATH</strong>:</p><ul><li>The script explicitly sets the <code>PATH</code> to a known secure set of directories, avoiding potential execution of malicious commands from user-controlled locations.</li></ul></li><li><p><strong>Dependency Checks</strong>:</p><ul><li>The <code>check_dependencies</code> function ensures that all required commands (<code>command1</code>, <code>command2</code>, etc.) are available before the script proceeds. You can replace these with actual dependencies.</li></ul></li><li><p><strong>Error Handling</strong>:</p><ul><li>The <code>error_handler</code> function is triggered on any error (via the <code>ERR</code> trap), providing useful information about where the error occurred and what the exit code was.</li></ul></li></ol><p>Feel free to use this template as a foundation for your own scripts and tweak it to fit your needs!</p></section><footer class=article-footer><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Oct 23, 2024 17:02 UTC</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 killparty.github.io</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>